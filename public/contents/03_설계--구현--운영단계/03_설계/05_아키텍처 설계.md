## 아키텍처 설계

### Inner 아키텍처 

아래와 같은 육각형 모형의 아키텍쳐를 헥사고날 아키텍쳐라고 합니다. 
이는 가운데 영역인 비지니스 로직 (도메인 영역)을 손상시키지 않고 프로그램을 구성하도록 고안된 아키텍처입니다. 
비지니스 로직을 손상시키지 않고 프로그램을 구현하기 위해서는 비지니스 로직에 특정 프로토콜이나 프로그램에 종속적인 코드가 들어가면 안됩니다. 

예를 들어 데이터베이스에 종속적인 Query 를 직접 사용하였다면, 데이터베이스가 변경되는 상황이 발생한다면 해당 로직은 모두 다시 만들어야 합니다. 
마찬가지로 메세지브로커를 사용하는 경우 특정 브로커의 코드를 직접적으로 사용하면 변경이 생길 때나, 여러 브로커를 사용하는 경우가 생기면, 다시 구현을 해야하는 이슈가 생기게 됩니다.

이처럼 비지니스 로직은 순수한 형태로 구현을 하고, 그 이외의 것을 adapter 형식으로 설계를 하여 해당 비지니스 로직이
 어느 환경에서도 잘 동작하도록 설계한 모형이 헥사고날 아키텍처이고, 마이크로 서비스 아키텍쳐에서는 이와 같은 방식을 지향합니다.

<div style="text-align: center;">

![스크린샷%202019-11-27%20오후%202](/img/03_Bizdevops/04/01/image88.png)

</div>

<br/>

### MSA Chassis

MSA Chassis 라는 말은 마이크로 서비스를 구축할때 필요한 프레임워크들의 모음입니다. 마치 ‘창틀처럼 이것저것 끼워 넣는다’로 해석할 수도 있습니다. 위에 설명한 헥사고날 아키텍처로 설계를 하여 비지니스 로직에 영향이 없는 개발을 맨땅에서 하려면 많은 공수가 필요합니다. 이에 많은 프레임워크들이 이와 같은 패턴들을 구성해 놓고 제공중입니다.

Java 계열에서 가장 선두주자인 Spring 프레임워크에서 마이크로 서비스에 적합한 spring-boot 프레임워크를 내어 놓았고, 이에 여러가지 어뎁터들에 해당하는 프로젝트들이 존재합니다. 아래 그림은 헥사고날 아키텍쳐에 spring-boot를 기반으로 한 MSA Chassis 를 입힌 모형입니다. Spring-Data-Rest 를 사용하여 Data 를 외부와 Rest 방식으로 연결시키고 , String-Cloud-Stream 으로 메세지 처리를 하는 로직을 구현하여 특정 브로커에 종속적이지 않은 adapter 패턴으로 구현된 모형입니다.

![스크린샷%202019-11-27%20오후%202](/img/03_Bizdevops/04/02/image89.png)

<br/>

---

<br/>

### Outer 아키텍처

마이크로서비스 아키텍처는 Inner와 Outer 로 구분하고 있으며, Outer 아키텍처는 가트너에서 6개의 서브 영역(아래 참조)으로 세분화하고 있습니다.

<div style="text-align: center;">

![가트너 MSA](/img/03_Bizdevops/07/01/image96.png)

</div>

<br/>

#### **API Gateway**

API Gateway는 마이크로서비스 외부로부터의 통합 접근을 위한 단일창구를 제공하며, 인증, 권한에 대한 통합 제어를 수행합니다.

#### **Service Mesh**

마이크로서비스의 네트워크 제어뿐만 아니라, 서비스간 Advanced한 호출 제어 및 트랜잭션을 관리 합니다.

#### **Container Management**

마이크로서비스를 물리적으로 적재하는 기반이며 논리적인 서비스 운영이 가능합니다. 컨테이너 기반의 대규모 마이크로서비스가 관리됩니다.

#### **Backing Services**

마이크로서비스에서 어플리케이션이 실행되는 가운데 네트워크를 통해서 사용할 수 있는 모든 서비스를 지칭합니다. 예를 들어 데이터베이스, 메시지/큐 시스템,  SMTP 서비스, 캐시 시스템이 있습니다.

#### **Telemetry**

마이크로서비스 아키텍처의 메트릭 기반 전 구간을 모니터링하며, 물리적으로 분산되어 운영되는 컨테이너 기반의 마이크로서비스에 대한 로그를 수집하고 서비스를 추적합니다.

#### **CI/CD Automation**

마이크로서비스의 소스Build에서부터 단위테스트와 컨트랙 테스트를 수행하는 Continuous Integration 영역과 도커 이미지를 생성해 운영 환경에 자동 배포되는 Continuous Deployment를 담당합니다.

<br/><br/>