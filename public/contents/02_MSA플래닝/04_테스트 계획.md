## 테스트 계획
마이크로서비스가 정착되기 위해서는 ‘MSA 아키텍처’, ‘조직 문화’, ‘CI/CD DevOps환경’의 3 요소가 실현되어야 한다.

MSA의 목적은 비즈니스 중심의 작은 단위인 서비스를 잦은 배포를 통해 비즈니스 Agility를 높이고자 하는 것과 장애에
 안전한 시스템(**Fault tolerant system**)을 구축하는 것을 가장 큰 목적으로 하고 있다. 배포를 빠르게 하려면 우선 소스
사이즈가 작아야 하고, 언제든지 배포할 수 있도록 지속적인 배포 가능한 환경을 구축해야 한다.

서비스의 사이즈가 줄어든 대신, 개수가 많아졌기 때문에 지속적 배포환경에서 이들 서비스간의 테스트 전략 및 테스트 
자동화는 더욱 중요한 요소로 부각된다.

### **단위(Unit) 테스트**

  - 소스코드의 특정 모듈이 의도된 대로 작동하는 지에 대한 검사로 테스트 더블(Mock 객체)을 활용하여 테스트 실행

![](/img/02_Planning/04/image10.png)

### **서비스(통합) 테스트**

  - 배포 완료된 완료된 마이크로서비스에 대해 수행

  - 단위 테스트의 상위 레이이어 위치하며, 구체적인 로직보다는 실제 네트워크 호출이나 데이테베이스 호출을 포함한 테스트 실행

  - 서비스 테스트 전략의 일환으로 모든 서비스를 테스트 하는 대신, 서비스간 통신을 담당하는 어댑터에 대해서만 테스트
    수행하기도 함

![](/img/02_Planning/04/image11.png)

### **UI(E2E) 테스트**

  - 시스템의 모든 컴포넌트가 에정된 방식으로 잘 동작하는지를 확인하는 테스트

  - 모든 서비스에 존재하는 앤드 포인트에 대한 부하 및 성능 테스트 방안 고려

  - 거의 수행하진 않으나, BDD(Behaviour-Driven Development) 기반의 레코딩 테스트 방안 고려

> ☞ BDD(Behaviour-Driven Development) 란?  
> TDD와 유사하나, TDD는 테스트 자체에 집중하여 개발하는 반면, BDD는 비즈니스 요구사항에 집중하여 테스트 케이스 개발

### **Contract 테스트**

Contract는 실제 서비스 소비자가 활용하는 API규약이다. Contract 테스트는 서비스 간의 API가 정상적으로 동작하는
지에 대한 테스트로, 서비스 제공자가 내 서비스를 사용하는 사용자에 대한 인사이트를 얻기 위한 것이 그 목적이다.

\[테스트 절차\]

  - API 소비자가 먼저 계약서 작성

  - API 제공자가 계약서를 수신하여 테스트를 수행하고 생성된 Mock 객체를 소비자에 전달

  - API 소비자는 Mock 객체를 통해 Stub서버를 자동 생성하여 테스트 수행

MSA에서 Contract 테스트 실패는 배포 시 장애로 연결될 수 있으므로, 소비자 주도의 Contract를 제공자 측에
적용하여 API 제공자의 일방적인 버전 업에 따른 하위 호환성 위배를 원천적으로 방지한다.

![](/img/02_Planning/04/image12.png)

\[Contract 전, 후 비교\]

![](/img/02_Planning/04/image13.png)
